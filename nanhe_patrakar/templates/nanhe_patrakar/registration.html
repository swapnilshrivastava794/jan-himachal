{% extends 'nanhe_patrakar/base.html' %}
{% block title %}पंजीकरण - {{ program.name }} - जन हिमाचल{% endblock %}

{% block extra_css %}
<style>
  :root {
    --primary-gradient: linear-gradient(135deg, #FF6B6B 0%, #D32F2F 100%);
    --bg-pattern: radial-gradient(#e0e0e0 1px, transparent 1px);
    --card-shadow: 0 10px 30px rgba(0,0,0,0.08);
  }

  .registration-page {
    background-color: #f8f9fa;
    background-image: var(--bg-pattern);
    background-size: 20px 20px;
    padding: 60px 0;
    min-height: 100vh;
  }

  .registration-card {
    max-width: 800px;
    margin: 0 auto;
  }

  /* Header Card */
  .card {
    border: none;
    border-radius: 15px;
    box-shadow: var(--card-shadow);
    overflow: hidden;
    margin-bottom: 30px !important;
  }

  .card-header {
    background: var(--primary-gradient) !important;
    color: #fff !important;
    text-align: center;
    font-size: 24px;
    font-weight: 700;
    padding: 25px;
    border: none !important;
  }
  
  .card-body {
    padding: 25px;
  }

  /* Requirements Box */
  .requirements-box {
    background: #fff;
    border-left: 5px solid var(--primary-color);
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: var(--card-shadow);
    transition: transform 0.3s ease;
  }
  
  .requirements-box:hover {
    transform: translateY(-5px);
  }

  .requirements-box h6 {
    color: #333;
    font-weight: 800;
    margin-bottom: 20px;
    font-size: 18px;
    display: flex;
    align-items: center;
  }

  .requirements-box ul {
    margin-bottom: 15px;
    padding-left: 0;
    list-style: none;
  }

  .requirements-box li {
    margin-bottom: 12px;
    line-height: 1.6;
    position: relative;
    padding-left: 25px;
    font-size: 15px;
  }
  
  .requirements-box li::before {
    content: '✓';
    position: absolute;
    left: 0;
    color: var(--primary-color);
    font-weight: bold;
  }

  .requirements-box .fee {
    background: var(--primary-gradient);
    color: #fff;
    padding: 12px 25px;
    border-radius: 50px;
    display: inline-block;
    font-weight: 700;
    margin-top: 15px;
    box-shadow: 0 5px 15px rgba(211, 47, 47, 0.3);
  }

  /* Form Section */
  .form-section {
    background: #fff;
    padding: 40px;
    border-radius: 20px;
    box-shadow: var(--card-shadow);
    border: none;
  }

  .section-title {
    font-size: 18px;
    font-weight: 800;
    color: #333;
    margin-bottom: 25px;
    padding-bottom: 12px;
    border-bottom: 2px solid #f0f0f0;
    position: relative;
  }
  
  .section-title::after {
    content: '';
    position: absolute;
    bottom: -2px;
    left: 0;
    width: 60px;
    height: 2px;
    background: var(--primary-color);
  }

  .form-label {
    font-weight: 600;
    color: #444;
    font-size: 14px;
    margin-bottom: 8px;
  }
  
  .form-control, .form-select {
    padding: 12px 15px;
    border-radius: 10px;
    border: 1px solid #e0e0e0;
    background: #fdfdfd;
    font-size: 15px;
    transition: all 0.3s;
  }

  .form-control:focus, .form-select:focus {
    background: #fff;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(230, 57, 70, 0.1);
  }

  .form-help-text {
    font-size: 13px;
    color: #888;
    margin-top: 6px;
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .submit-btn {
    width: 100%;
    padding: 18px;
    font-size: 18px;
    font-weight: 800;
    text-transform: uppercase;
    background: var(--primary-gradient);
    border: none;
    border-radius: 50px;
    box-shadow: 0 10px 20px rgba(211, 47, 47, 0.3);
    transition: all 0.3s;
    letter-spacing: 1px;
  }
  
  .submit-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 15px 30px rgba(211, 47, 47, 0.4);
    background: linear-gradient(135deg, #FF6B6B 0%, #b71c1c 100%);
  }

  .login-link {
    text-align: center;
    margin-top: 30px;
    padding-top: 20px;
    border-top: 1px solid #eee;
  }

  .required-mark {
    color: var(--primary-color);
    font-weight: bold;
    margin-left: 3px;
  }

  .password-wrapper {
    position: relative;
  }

  .password-toggle {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: #999;
    background: none;
    border: none;
    padding: 5px;
    transition: color 0.3s;
  }

  .password-toggle:hover {
    color: var(--primary-color);
  }

  .age-groups-info {
    background: #f0f7ff;
    padding: 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    border: 1px solid #e1f0ff;
  }

  .age-groups-info h6 {
    margin-bottom: 15px;
    font-size: 16px;
    color: #0d47a1;
  }

  .age-group-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 0;
    font-size: 14px;
    border-bottom: 1px dashed #cedceb;
  }
  
  .age-group-item:last-child {
    border-bottom: none;
  }

  .age-group-name {
    font-weight: 700;
    color: #1976d2;
  }

  .form-check-input {
    width: 20px;
    height: 20px;
    margin-top: 3px;
    border: 2px solid #ccc;
    cursor: pointer;
  }
  
  .form-check-input:checked {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
  }
  
  .form-check-label {
    padding-left: 8px;
    cursor: pointer;
    font-size: 14px;
    line-height: 1.5;
  }

  @media (max-width: 768px) {
    .registration-page {
        padding: 30px 15px;
    }
    
    .card-header {
        padding: 20px;
        font-size: 20px;
    }
    
    .form-section {
        padding: 25px;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="registration-page">
  <div class="container">
    <div class="registration-card">
      <!-- Page Header -->
      <div class="card mb-4">
        <div class="card-header">
          <i class="fas fa-user-plus me-2"></i>
          माता-पिता पंजीकरण / Parent Registration
        </div>
        <div class="card-body">
          <p class="text-center mb-2">
            अपने बच्चे को {{ program.name }} में नामांकित करने के लिए पंजीकरण करें
          </p>
          <p class="text-center text-muted mb-0">
            <small>Register to enroll your child in {{ program.name }}</small>
          </p>
        </div>
      </div>

      <!-- Requirements Box -->
      <div class="requirements-box">
        <h6>
          <i class="fas fa-check-circle me-2"></i>पात्रता मानदंड / Eligibility Requirements
        </h6>
        <ul>
          <li>
            <strong>आयु सीमा:</strong> बच्चे की आयु {{ program.min_age }}-{{ program.max_age }} वर्ष के बीच होनी चाहिए
          </li>
          <li>
            <strong>निवास:</strong> हिमाचल प्रदेश का निवासी होना आवश्यक है
          </li>
          <li>
            <strong>माता-पिता की सहमति:</strong> माता-पिता/अभिभावक की पूर्ण सहमति आवश्यक है
          </li>
        </ul>

        <!-- Age Groups Info -->
        {% if program.age_group_a_min and program.age_group_a_max %}
        <div class="age-groups-info">
          <h6><i class="fas fa-users me-1"></i>आयु समूह / Age Groups:</h6>
          
          {% if program.age_group_a_min and program.age_group_a_max %}
          <div class="age-group-item">
            <span class="age-group-name">समूह अ / Group A:</span>
            <span class="age-group-range">{{ program.age_group_a_min }}-{{ program.age_group_a_max }} वर्ष / years</span>
          </div>
          {% endif %}
          
          {% if program.age_group_b_min and program.age_group_b_max %}
          <div class="age-group-item">
            <span class="age-group-name">समूह ब / Group B:</span>
            <span class="age-group-range">{{ program.age_group_b_min }}-{{ program.age_group_b_max }} वर्ष / years</span>
          </div>
          {% endif %}
          
          {% if program.age_group_c_min and program.age_group_c_max %}
          <div class="age-group-item">
            <span class="age-group-name">समूह स / Group C:</span>
            <span class="age-group-range">{{ program.age_group_c_min }}-{{ program.age_group_c_max }} वर्ष / years</span>
          </div>
          {% endif %}
        </div>
        {% endif %}

        <div class="fee">
          <i class="fas fa-rupee-sign me-1"></i>{{ program.price }} - एकमुश्त भागीदारी शुल्क
        </div>
      </div>

      <!-- Registration Form -->
      <div class="form-section">
        <form method="post" id="registrationForm" novalidate>
          {% csrf_token %}

          <!-- Personal Information Section -->
          <div class="section-title">
            <i class="fas fa-user me-2"></i>व्यक्तिगत जानकारी / Personal Information
          </div>

          <div class="row">
            <!-- First Name -->
            <div class="col-md-6 mb-3">
              <label class="form-label" for="{{ form.first_name.id_for_label }}">
                पहला नाम / First Name <span class="required-mark">*</span>
              </label>
              {{ form.first_name }}
              {% if form.first_name.errors %}
              <div class="text-danger small mt-1">
                <i class="fas fa-exclamation-circle"></i> {{ form.first_name.errors.0 }}
              </div>
              {% endif %}
            </div>

            <!-- Last Name -->
            <div class="col-md-6 mb-3">
              <label class="form-label" for="{{ form.last_name.id_for_label }}">
                उपनाम / Last Name <span class="required-mark">*</span>
              </label>
              {{ form.last_name }}
              {% if form.last_name.errors %}
              <div class="text-danger small mt-1">
                <i class="fas fa-exclamation-circle"></i> {{ form.last_name.errors.0 }}
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Username -->
          <div class="mb-3">
            <label class="form-label" for="{{ form.username.id_for_label }}">
              यूजरनेम / Username <span class="required-mark">*</span>
            </label>
            {{ form.username }}
            <div class="form-help-text">
              <i class="fas fa-info-circle"></i> लॉगिन के लिए उपयोग किया जाएगा / Will be used for login
            </div>
            {% if form.username.errors %}
            <div class="text-danger small mt-1">
              <i class="fas fa-exclamation-circle"></i> {{ form.username.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Mobile Number -->
          <div class="mb-3">
            <label class="form-label" for="{{ form.mobile.id_for_label }}">
              मोबाइल नंबर / Mobile Number <span class="required-mark">*</span>
            </label>
            {{ form.mobile }}
            <div class="form-help-text">
              <i class="fas fa-info-circle"></i> इस नंबर से आप ऐप में लॉगिन कर सकेंगे / You can login to app with this number
            </div>
            {% if form.mobile.errors %}
            <div class="text-danger small mt-1">
              <i class="fas fa-exclamation-circle"></i> {{ form.mobile.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Email Address -->
          <div class="mb-3">
            <label class="form-label" for="{{ form.email.id_for_label }}">
              ईमेल पता / Email Address <span class="required-mark">*</span>
            </label>
            {{ form.email }}
            {% if form.email.errors %}
            <div class="text-danger small mt-1">
              <i class="fas fa-exclamation-circle"></i> {{ form.email.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Password -->
          <div class="mb-3">
            <label class="form-label" for="{{ form.password.id_for_label }}">
              पासवर्ड / Password <span class="required-mark">*</span>
            </label>
            <div class="password-wrapper">
              {{ form.password }}
              <button type="button" class="password-toggle" onclick="togglePassword('{{ form.password.id_for_label }}')">
                <i class="fas fa-eye" id="toggleIcon_{{ form.password.id_for_label }}"></i>
              </button>
            </div>
            <div class="form-help-text">
              <i class="fas fa-info-circle"></i> कम से कम 6 अक्षर / Minimum 6 characters
            </div>
            {% if form.password.errors %}
            <div class="text-danger small mt-1">
              <i class="fas fa-exclamation-circle"></i> {{ form.password.errors.0 }}
            </div>
            {% endif %}
          </div>

          <!-- Location Details Section -->
          <div class="section-title mt-4">
            <i class="fas fa-map-marker-alt me-2"></i>स्थान विवरण / Location Details
          </div>

          <div class="row">
            <!-- City -->
            <div class="col-md-6 mb-3">
              <label class="form-label" for="{{ form.city.id_for_label }}">
                शहर / City <span class="required-mark">*</span>
              </label>
              {{ form.city }}
              {% if form.city.errors %}
              <div class="text-danger small mt-1">
                <i class="fas fa-exclamation-circle"></i> {{ form.city.errors.0 }}
              </div>
              {% endif %}
            </div>

            <!-- District -->
            <div class="col-md-6 mb-3">
              <label class="form-label" for="{{ form.district.id_for_label }}">
                जिला / District <span class="required-mark">*</span>
              </label>
              {{ form.district }}
              {% if form.district.errors %}
              <div class="text-danger small mt-1">
                <i class="fas fa-exclamation-circle"></i> {{ form.district.errors.0 }}
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Terms & Conditions Section -->
          <div class="section-title mt-4">
            <i class="fas fa-file-contract me-2"></i>नियम और शर्तें / Terms & Conditions
          </div>

          <div class="mb-4">
            <div class="form-check">
              {{ form.terms_accepted }}
              <label class="form-check-label" for="{{ form.terms_accepted.id_for_label }}">
                मैं
                <a href="#" class="text-primary" target="_blank">नियम और शर्तें</a>
                तथा
                <a href="#" class="text-primary" target="_blank">गोपनीयता नीति</a>
                से सहमत हूं
                <span class="required-mark">*</span>
              </label>
              {% if form.terms_accepted.errors %}
              <div class="text-danger small mt-1">
                <i class="fas fa-exclamation-circle"></i> {{ form.terms_accepted.errors.0 }}
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Submit Button -->
          <button type="submit" class="btn btn-primary submit-btn">
            <i class="fas fa-user-plus me-2"></i>पंजीकरण करें / Register
          </button>
        </form>

        <!-- Login Link -->
        <div class="login-link">
          <p class="text-muted mb-0">
            पहले से पंजीकृत हैं? / Already registered?
            <a href="#" class="text-primary fw-semibold">यहां लॉगिन करें / Login here</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Toggle password visibility
  function togglePassword(fieldId) {
    const passwordField = document.getElementById(fieldId);
    const toggleIcon = document.getElementById('toggleIcon_' + fieldId);
    
    if (passwordField.type === 'password') {
      passwordField.type = 'text';
      toggleIcon.classList.remove('fa-eye');
      toggleIcon.classList.add('fa-eye-slash');
    } else {
      passwordField.type = 'password';
      toggleIcon.classList.remove('fa-eye-slash');
      toggleIcon.classList.add('fa-eye');
    }
  }

  // Mobile number formatting - only numbers
  const mobileField = document.getElementById("{{ form.mobile.id_for_label }}");
  if (mobileField) {
    mobileField.addEventListener("input", function (e) {
      let value = e.target.value.replace(/\D/g, "");
      if (value.length > 10) {
        value = value.slice(0, 10);
      }
      e.target.value = value;
    });
  }

  // Username validation - no spaces, special characters
  const usernameField = document.getElementById("{{ form.username.id_for_label }}");
  if (usernameField) {
    usernameField.addEventListener("input", function (e) {
      // Remove spaces and convert to lowercase
      let value = e.target.value.replace(/\s/g, "").toLowerCase();
      // Only allow alphanumeric, underscore, and hyphen
      value = value.replace(/[^a-z0-9_-]/g, "");
      e.target.value = value;
    });
  }

  // Form validation before submit
  document.getElementById("registrationForm").addEventListener("submit", function (e) {
    const mobile = document.getElementById("{{ form.mobile.id_for_label }}").value;
    const username = document.getElementById("{{ form.username.id_for_label }}").value;
    const password = document.getElementById("{{ form.password.id_for_label }}").value;
    
    let errors = [];

    // Validate mobile
    if (mobile.length !== 10) {
      errors.push("कृपया वैध 10 अंकों का मोबाइल नंबर दर्ज करें / Please enter a valid 10-digit mobile number");
    }

    // Validate username
    if (username.length < 3) {
      errors.push("यूजरनेम कम से कम 3 अक्षरों का होना चाहिए / Username must be at least 3 characters");
    }

    // Validate password
    if (password.length < 6) {
      errors.push("पासवर्ड कम से कम 6 अक्षरों का होना चाहिए / Password must be at least 6 characters");
    }

    if (errors.length > 0) {
      e.preventDefault();
      alert(errors.join("\n\n"));
    }
  });
</script>
{% endblock %}