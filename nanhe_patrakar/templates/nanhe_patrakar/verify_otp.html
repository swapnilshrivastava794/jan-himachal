{% extends 'nanhe_patrakar/base.html' %}

{% block title %}OTP सत्यापन - नन्हे पत्रकार{% endblock %}

{% block extra_css %}
<style>
    .otp-verification-page {
        padding: 60px 0;
        background: #f8f9fa;
    }
    
    .otp-card {
        max-width: 500px;
        margin: 0 auto;
    }
    
    .verification-icon {
        width: 100px;
        height: 100px;
        background: var(--primary-color);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 25px;
        font-size: 48px;
        color: #fff;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% {
            transform: scale(1);
        }
        50% {
            transform: scale(1.05);
        }
    }
    
    .mobile-display {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 4px;
        text-align: center;
        margin-bottom: 30px;
        border: 1px solid var(--border-color);
    }
    
    .mobile-display .label {
        font-size: 14px;
        color: var(--text-light);
        margin-bottom: 8px;
    }
    
    .mobile-display .number {
        font-size: 22px;
        font-weight: 700;
        color: #000;
        letter-spacing: 2px;
    }
    
    .otp-input-wrapper {
        margin: 30px 0;
    }
    
    .otp-input {
        font-size: 32px;
        letter-spacing: 15px;
        text-align: center;
        font-weight: 700;
        height: 70px;
        border: 3px solid var(--primary-color);
        color: var(--primary-color);
        background: #fff;
    }
    
    .otp-input:focus {
        border-color: var(--primary-color);
        box-shadow: 0 0 0 4px rgba(211, 47, 47, 0.2);
    }
    
    .verify-btn {
        width: 100%;
        padding: 15px;
        font-size: 18px;
        font-weight: 700;
        text-transform: uppercase;
        background: var(--primary-color);
    }
    
    .verify-btn:hover {
        background: #c92a36;
    }
    
    .resend-section {
        text-align: center;
        padding: 25px 0;
        border-top: 1px solid #e0e0e0;
        margin-top: 25px;
    }
    
    .countdown-timer {
        font-size: 16px;
        font-weight: 700;
        color: var(--secondary-color);
        margin: 10px 0;
    }
    
    .countdown-timer .time {
        font-size: 24px;
        color: var(--primary-color);
    }
    
    .resend-btn {
        border: none;
        background: none;
        color: var(--primary-color);
        font-weight: 700;
        text-decoration: underline;
        cursor: pointer;
        padding: 0;
    }
    
    .resend-btn:hover {
        color: #b71c1c;
    }
    
    .back-link {
        text-align: center;
        margin-top: 20px;
    }
    
    .back-link a {
        color: var(--text-light);
        text-decoration: none;
        font-size: 14px;
    }
    
    .back-link a:hover {
        color: var(--primary-color);
    }
    
    .otp-info {
        background: #fff3cd;
        padding: 15px;
        border-radius: 3px;
        border-left: 3px solid #ffc107;
        margin-bottom: 20px;
        font-size: 14px;
    }
</style>
{% endblock %}

{% block content %}
<div class="otp-verification-page">
    <div class="container">
        <div class="otp-card">
            <div class="card">
                <div class="card-body p-4 p-md-5">
                    <div class="text-center mb-4">
                        <div class="verification-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <h2 class="fw-bold mb-2" style="color: var(--primary-color);">
                            OTP सत्यापन
                        </h2>
                        <p class="text-muted">OTP Verification</p>
                    </div>

                    <div class="mobile-display">
                        <div class="label">कोड भेजा गया / Code sent to</div>
                        <div class="number">
                            <i class="fas fa-phone-alt me-2"></i>{{ masked_mobile }}
                        </div>
                    </div>

                    <div class="otp-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>ध्यान दें:</strong> आपके मोबाइल नंबर पर 6 अंकों का OTP भेजा गया है। यह 5 मिनट के लिए मान्य है।
                    </div>

                    <form method="post" id="otpForm">
                        {% csrf_token %}
                        
                        <div class="otp-input-wrapper">
                            <label class="form-label text-center w-100 mb-3" for="{{ form.otp.id_for_label }}">
                                <strong>6 अंकों का OTP दर्ज करें / Enter 6-digit OTP</strong>
                            </label>
                            <input 
                                type="text" 
                                name="otp" 
                                id="{{ form.otp.id_for_label }}" 
                                class="form-control otp-input" 
                                maxlength="6" 
                                placeholder="000000"
                                required
                                autocomplete="off"
                                inputmode="numeric"
                                pattern="[0-9]{6}"
                            >
                            {% if form.otp.errors %}
                                <div class="text-danger text-center mt-3">
                                    <i class="fas fa-exclamation-circle me-1"></i>
                                    {{ form.otp.errors.0 }}
                                </div>
                            {% endif %}
                        </div>

                        <button type="submit" class="btn btn-primary verify-btn" id="verifyBtn">
                            <i class="fas fa-check-circle me-2"></i>
                            सत्यापित करें / Verify
                        </button>
                    </form>

                    <div class="resend-section">
                        <div id="countdownSection">
                            <p class="text-muted mb-2">OTP प्राप्त नहीं हुआ? / Didn't receive OTP?</p>
                            <div class="countdown-timer">
                                <span class="time" id="countdown">60</span> सेकंड में पुनः भेजें
                            </div>
                        </div>
                        <div id="resendButton" style="display: none;">
                            <p class="text-muted mb-2">OTP प्राप्त नहीं हुआ?</p>
                            <form method="post" action="{% url 'nanhe_patrakar:resend_otp' %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit" class="resend-btn">
                                    <i class="fas fa-redo-alt me-1"></i>
                                    नया OTP भेजें / Resend OTP
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="back-link">
                        <a href="{% url 'nanhe_patrakar:register' %}">
                            <i class="fas fa-arrow-left me-1"></i>
                            पंजीकरण पर वापस जाएं / Back to Registration
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-focus OTP input
    const otpInput = document.getElementById('{{ form.otp.id_for_label }}');
    otpInput.focus();
    
    // Only allow numbers in OTP field
    otpInput.addEventListener('input', function(e) {
        e.target.value = e.target.value.replace(/\D/g, '');
    });
    
    // Auto-submit when 6 digits entered
    otpInput.addEventListener('input', function(e) {
        if (e.target.value.length === 6) {
            // Add loading state
            const verifyBtn = document.getElementById('verifyBtn');
            verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>सत्यापित हो रहा है...';
            verifyBtn.disabled = true;
            
            // Submit after small delay for better UX
            setTimeout(() => {
                document.getElementById('otpForm').submit();
            }, 500);
        }
    });
    
    // Countdown timer
    let countdown = 60;
    const countdownElement = document.getElementById('countdown');
    const countdownSection = document.getElementById('countdownSection');
    const resendButton = document.getElementById('resendButton');
    
    const timer = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
            clearInterval(timer);
            countdownSection.style.display = 'none';
            resendButton.style.display = 'block';
        }
    }, 1000);
    
    // Add visual feedback on form submit
    document.getElementById('otpForm').addEventListener('submit', function(e) {
        const verifyBtn = document.getElementById('verifyBtn');
        if (!verifyBtn.disabled) {
            verifyBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>सत्यापित हो रहा है...';
            verifyBtn.disabled = true;
        }
    });
</script>
{% endblock %}